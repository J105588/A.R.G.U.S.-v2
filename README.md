# A.R.G.U.S.-v2 - Advanced Real-time Guard & Utility System

A.R.G.U.S. は、ローカルで動作する高機能なフィルタリング・プロキシシステムです。指定したドメインへのアクセスをブロックし、すべての通信ログを記録・管理するためのWebダッシュボードを提供します。

---

## 主な機能

-   **ドメインベースのアクセスブロック**: `config/blocked_domains.txt` ファイルにドメインをリストアップするだけで、リアルタイムにHTTP/HTTPSアクセスをブロックします。
-   **カスタマイズ可能なブロックページ**: ユーザーがアクセスをブロックされた際に表示されるページを、`templates/blocked_page.html`で自由にデザインできます。
-   **Web管理ダッシュボード**:
    -   すべての通信ログ（許可/ブロック）を閲覧・検索できます。(`http://127.0.0.1:5000`)
    -   ページネーション機能により、大量のログも快適に閲覧可能です。
    -   データベース内の全ログをクリアする機能も搭載しています。
-   **リアルタイム監視コンソール**:
    -   すべての通信フローをリアルタイムで確認できる`mitmweb`のインターフェースを提供します。(`http://127.0.0.1:8081`)
-   **安定した実行環境**:
    -   Pythonの仮想環境（venv）を利用することで、PC環境に影響を与えず、ライブラリの依存関係問題を完全に解決します。

---

## 必須要件

-   **OS**: Windows 10 / 11
-   **Python**: Version 3.8 以上
    -   インストール時に**「Add Python to PATH」**または**「Install launcher for all users」**のオプションを有効にしてください。これはコマンドプロンプトで`python`または`py`コマンドを認識させるために重要です。

---

## インストールとセットアップ (手動)

A.R.G.U.S. を使用するには、最初に一度だけ以下のセットアップ手順を実行する必要があります。ここでは、コマンドプロンプト（`cmd.exe`）を使い、一つずつコマンドを実行していきます。

### ステップ 1: プロジェクトフォルダへ移動

まず、コマンドプロンプトを開き、`cd`コマンドでA.R.G.U.S.のプロジェクトフォルダに移動します。

```cmd  
cd /d "C:\path\to\your\A.R.G.U.S-project"  
```
*(例: `cd /d "C:\dev\A.R.G.U.S.-v2"`)*

### ステップ 2: Python仮想環境の作成

次に、このプロジェクト専用の隔離されたPython環境を作成します。以下のコマンドを実行すると、プロジェクトフォルダ内に`venv`という名前のサブフォルダが作成されます。

```cmd  
py -3 -m venv venv  
```
*(もし`py`コマンドがなければ `python -m venv venv` を試してください)*

この操作は、PCごとに最初の1回だけでOKです。

### ステップ 3: 仮想環境の有効化 (Activate)

作成した仮想環境を有効にします。以下のコマンドを実行してください。

```cmd  
venv\Scripts\activate  
```

成功すると、コマンドプロンプトの行の先頭に `(venv)` というプレフィックスが表示されます。これは、以降のコマンドがこの隔離された環境内で実行されることを示しています。

**(重要)** A.R.G.U.S.を起動する前や、ライブラリを追加する前には、必ずこの有効化のステップが必要になります。

### ステップ 4: 必要なライブラリのインストール

仮想環境が有効な状態で、プロジェクトに必要なPythonライブラリをインストールします。以下のコマンドを実行してください。

```cmd  
pip install mitmproxy flask sqlalchemy  
```
`pip`コマンドが、必要な3つのライブラリをダウンロードし、`venv`環境内にインストールします。

これで、すべてのセットアップ作業は完了です。

---

## 使い方

### 1. A.R.G.U.S. の起動

1.  コマンドプロンプトを開き、プロジェクトフォルダに移動します (`cd /d "..."`)。
2.  仮想環境を有効化します (`venv\Scripts\activate`)。
3.  **1つ目のコマンドプロンプト**で、以下のコマンドを実行してWeb管理ダッシュボードを起動します。
    ```cmd  
    python main.py  
    ```
4.  **新しく別のコマンドプロンプトを開き**、そこでもプロジェクトフォルダへの移動と仮想環境の有効化（ステップ1, 2）を行います。
5.  **2つ目のコマンドプロンプト**で、以下のコマンドを実行してプロキシ本体を起動します。
    ```cmd  
    mitmweb -s proxy_addon.py --web-port 8081 --listen-port 8080 --set block_global=false  
    ```

**※** `final-start.bat` を使えば、上記の手順 (仮想環境の有効化と2つのサーバー起動) が自動化されます。`venv`が起動した状態で`final-start.bat`と入力します

### 2. プロキシの設定

お使いのブラウザ、またはWindows自体のプロキシ設定を以下のように構成します。

-   **プロキシサーバーのアドレス**: `127.0.0.1`
-   **ポート**: `8080`

### 3. ブロックリストの編集

ブロックしたいドメインを `config/blocked_domains.txt` ファイルに追記します。ファイルの変更はA.R.G.U.S.を再起動することなく即座に反映されます。

### 4. A.R.G.U.S. の終了

起動時に開いた2つのコマンドプロンプトウィンドウを、それぞれ右上の「×」ボタンで閉じるか、`Ctrl + C` を押してプロセスを終了してください。
